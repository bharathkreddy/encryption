cipher = """TW LXDKMWZG XWMHDL LXD AL RMIRQL TXD IWHRO. A XRED LDMVWH XDRKV XAH HDOTAWO XDK BOVDK ROQ WTXDK ORHD. 
AO XAL DQDL LXD DZMAJLDL ROV JKDVWHAORTDL TXD IXWMD WY XDK LDC. AT IRL OWT TXRT XD YDMT ROQ DHWTAWO RGAO TW MWED YWK AKDOD RVMDK. 
RMM DHWTAWOL, ROV TXRT WOD JRKTAZBMRKMQ, IDKD RUXWKKDOT TW XAL ZWMV, JKDZALD UBT RVHAKRUMQ URMROZDV HAOV. 
XD IRL, A TRGD AT, TXD HWLT JDKYDZT KDRLWOAOS ROV WULDKEAOS HRZXAOD TXRT TXD IWKMV XRL LDDO, UBT RL R MWEDK XD IWBMV XRED JMRZDV XAHLDMY AO R YRMLD JWLATAWO. 
XD ODEDK LJWGD WY TXD LWYTDK JRLLAWOL, LRED IATX R SAUD ROV R LODDK. TXDQ IDKD RVHAKRUMD TXAOSL YWK TXD WULDKEDK—DCZDMMDOT YWK VKRIAOS TXD EDAM YKWH HDO’L HWTAEDL ROV RZTAWOL. 
UBT YWK TXD TKRAODV KDRLWODK TW RVHAT LBZX AOTKBLAWOL AOTW XAL WIO VDMAZRTD ROV YAODMQ RVNBLTDV TDHJDKRHDOT IRL TW AOTKWVBZD R VALTKRZTAOS YRZTWK IXAZX HASXT TXKWI R VWBUT BJWO RMM XAL HDOTRM KDLBMTL. 
SKAT AO R LDOLATAED AOLTKBHDOT, WK R ZKRZG AO WOD WY XAL WIO XASX-JWIDK MDOLDL, IWBMV OWT UD HWKD VALTBKUAOS TXRO R LTKWOS DHWTAWO AO R ORTBKD LBZX RL XAL. ROV QDT TXDKD IRL UBT WOD IWHRO TW XAH, ROV TXRT IWHRO IRL TXD MRTD AKDOD RVMDK, WY VBUAWBL ROV PBDLTAWORUMD HDHWKQ. 
A XRV LDDO MATTMD WY XWMHDL MRTDMQ. HQ HRKKARSD XRV VKAYTDV BL RIRQ YKWH DRZX WTXDK. HQ WIO ZWHJMDTD XRJJAODLL, ROV TXD XWHD-ZDOTKDV AOTDKDLTL IXAZX KALD BJ RKWBOV TXD HRO IXW YAKLT YAOVL XAHLDMY HRLTDK WY XAL WIO DLTRUMALXHDOT, IDKD LBYYAZADOT TW RULWKU RMM HQ RTTDOTAWO, IXAMD XWMHDL, IXW MWRTXDV DEDKQ YWKH WY LWZADTQ IATX XAL IXWMD UWXDHARO LWBM, KDHRAODV AO WBK MWVSAOSL AO URGDK LTKDDT, UBKADV RHWOS XAL WMV UWWGL, ROV RMTDKORTAOS YKWH IDDG TW IDDG UDTIDDO ZWZRAOD ROV RHUATAWO, TXD VKWILAODLL WY TXD VKBS, ROV TXD YADKZD DODKSQ WY XAL WIO GDDO ORTBKD. 
XD IRL LTAMM, RL DEDK, VDDJMQ RTTKRZTDV UQ TXD LTBVQ WY ZKAHD, ROV WZZBJADV XAL AHHDOLD YRZBMTADL ROV DCTKRWKVAORKQ JWIDKL WY WULDKERTAWO AO YWMMWIAOS WBT TXWLD ZMBDL, ROV ZMDRKAOS BJ TXWLD HQLTDKADL IXAZX XRV UDDO RUROVWODV RL XWJDMDLL UQ TXD WYYAZARM JWMAZD. 
YKWH TAHD TW TAHD A XDRKV LWHD ERSBD RZZWBOT WY XAL VWAOSL: WY XAL LBHHWOL TW WVDLLR AO TXD ZRLD WY TXD TKDJWYY HBKVDK, WY XAL ZMDRKAOS BJ WY TXD LAOSBMRK TKRSDVQ WY TXD RTGAOLWO UKWTXDKL RT TKAOZWHRMDD, ROV YAORMMQ WY TXD HALLAWO IXAZX XD XRV RZZWHJMALXDV LW VDMAZRTDMQ ROV LBZZDLLYBMMQ YWK TXD KDASOAOS YRHAMQ WY XWMMROV. 
UDQWOV TXDLD LASOL WY XAL RZTAEATQ, XWIDEDK, IXAZX A HDKDMQ LXRKDV IATX RMM TXD KDRVDKL WY TXD VRAMQ JKDLL, A GODI MATTMD WY HQ YWKHDK YKADOV ROV ZWHJROAWO. 
WOD OASXT—AT IRL WO TXD TIDOTADTX WY HRKZX, 1888—A IRL KDTBKOAOS YKWH R NWBKODQ TW R JRTADOT (YWK A XRV OWI KDTBKODV TW ZAEAM JKRZTAZD), IXDO HQ IRQ MDV HD TXKWBSX URGDK LTKDDT. 
RL A JRLLDV TXD IDMM-KDHDHUDKDV VWWK, IXAZX HBLT RMIRQL UD RLLWZARTDV AO HQ HAOV IATX HQ IWWAOS, ROV IATX TXD VRKG AOZAVDOTL WY TXD LTBVQ AO LZRKMDT, A IRL LDAFDV IATX R GDDO VDLAKD TW LDD XWMHDL RSRAO, ROV TW GOWI XWI XD IRL DHJMWQAOS XAL DCTKRWKVAORKQ JWIDKL. 
XAL KWWHL IDKD UKAMMAROTMQ MAT, ROV, DEDO RL A MWWGDV BJ, A LRI XAL TRMM, LJRKD YASBKD JRLL TIAZD AO R VRKG LAMXWBDTTD RSRAOLT TXD UMAOV. 
XD IRL JRZAOS TXD KWWH LIAYTMQ, DRSDKMQ, IATX XAL XDRV LBOG BJWO XAL ZXDLT ROV XAL XROVL ZMRLJDV UDXAOV XAH. 
TW HD, IXW GODI XAL DEDKQ HWWV ROV XRUAT, XAL RTTATBVD ROV HROODK TWMV TXDAK WIO LTWKQ. XD IRL RT IWKG RSRAO. 
XD XRV KALDO WBT WY XAL VKBS-ZKDRTDV VKDRHL ROV IRL XWT BJWO TXD LZDOT WY LWHD ODI JKWUMDH. 
A KROS TXD UDMM ROV IRL LXWIO BJ TW TXD ZXRHUDK IXAZX XRV YWKHDKMQ UDDO AO JRKT HQ WIO. XAL HROODK IRL OWT DYYBLAED. 
AT LDMVWH IRL; UBT XD IRL SMRV, A TXAOG, TW LDD HD. IATX XRKVMQ R IWKV LJWGDO, UBT IATX R GAOVMQ DQD, XD IREDV HD TW RO RKHZXRAK, TXKDI RZKWLL XAL ZRLD WY ZASRKL, ROV AOVAZRTDV R LJAKAT ZRLD ROV R SRLWSDOD AO TXD ZWKODK. 
TXDO XD LTWWV UDYWKD TXD YAKD ROV MWWGDV HD WEDK AO XAL LAOSBMRK AOTKWLJDZTAED YRLXAWO."""

class Attack():
    def __init__(self) -> None:
        self.alphabets = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
        self.english_frequency = {'A': 0.0817, 'B': 0.015, 'C': 0.0278, 'D': 0.0425, 'E': 0.127, 
        'F': 0.0223, 'G': 0.0202, 'H': 0.0609, 'I': 0.0697, 'J': 0.0015, 'K': 0.0077, 'L': 0.0403, 
        'M': 0.0241, 'N': 0.0675, 'O': 0.0751, 'P': 0.0193, 'Q': 0.001, 'R': 0.0599, 'S': 0.0633, 
        'T': 0.0906, 'U': 0.0276, 'V': 0.0098, 'W': 0.0236, 'X': 0.0015, 'Y': 0.0197, 'Z': 0.0007}
        self.cipher_frequency={}
        self.mapping = {}
        self.key = {}
        self.message = ''
        self.english_chars_left = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
        self.cipher_chars_left = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'

    def calculate_cipher_frequency(self,cipher_text):
        count_total = 0
        for i in self.alphabets:
            self.cipher_frequency[i] = 0
        for i in cipher_text:
            if i in self.alphabets:
                if i in self.cipher_frequency:
                    self.cipher_frequency[i] += 1
                else:
                    self.cipher_frequency[i] = 1
            count_total += 1
        for i in self.cipher_frequency:
            self.cipher_frequency[i] = round((self.cipher_frequency[i]/count_total),4)

    def create_freq_map(self):
        for cipher_char in self.alphabets:
            map = {}
            for english_char in self.alphabets:
                map[english_char] = round(abs(self.cipher_frequency[cipher_char]-self.english_frequency[english_char]),4)
            self.mapping[cipher_char] = sorted(map.items(),key=lambda x: x[1])

    def set_key(self,c_char,e_char):
        if c_char not in self.cipher_chars_left or e_char not in self.english_chars_left:
            print('DUPLICATE MANUAL MAPPING')
            exit
        else:
            self.key[c_char] = e_char
            self.cipher_chars_left=self.cipher_chars_left.replace(c_char,'')
            self.english_chars_left=self.english_chars_left.replace(e_char,'')
        

    def guess_key(self): 
        for i in self.cipher_chars_left:
            for english_char,diff in self.mapping[i]:
                if english_char in self.english_chars_left:
                    self.key[i]=english_char
                    self.english_chars_left = self.english_chars_left.replace(english_char,'')
                    break
    
    def decrypt(self):
        msg=''
        for i in cipher:
            if i in self.key:
                msg += self.key[i]
            else:
                msg += i
        self.message = msg

            
attack = Attack()
attack.calculate_cipher_frequency(cipher_text=cipher)
# print(attack.cipher_frequency)
attack.create_freq_map()
#print(attack.mapping)
attack.set_key('A','I')
attack.set_key('B','U')
attack.set_key('C','X')
attack.set_key('D','E')
attack.set_key('E','V')
attack.set_key('H','M')
attack.set_key('L','S')
attack.set_key('M','L')
attack.set_key('O','N')
attack.set_key('R','A')
attack.set_key('T','T')
attack.set_key('U','B')
attack.set_key('V','D')
attack.set_key('W','O')
attack.set_key('X','H')
attack.set_key('Y','F')

attack.guess_key()
# print(attack.key)
attack.decrypt()
# print(attack.message)

cipher_lines = cipher.splitlines()
msg_lines = attack.message.splitlines()
for i in range(len(cipher_lines)):
    print("P :",msg_lines[i])
    print("C :",cipher_lines[i])
    print()






    